{"version":3,"sources":["App.tsx","index.tsx"],"names":["suffixLength","length","App","useState","records","setRecords","selectedRecordIndex","setSelectedRecordIndex","filter","setFilter","useEffect","a","fetch","response","text","split","slice","map","fileName","state","loadRecord","recordIndex","record","index","items","item","id","name","stars","link","Number","_record","error","setForceUpdateNonce","handleToggleButtonClick","event","currentTarget","dataset","undefined","Error","localStorage","getItem","removeItem","setItem","Date","now","renderRelatedRecord","flipSign","findIndex","i","comparedItem","change","difference","Math","abs","sign","onClick","onChange","value","key","placeholder","href","selectedRecord","message","prevRecord","nextRecord","toUpperCase","includes","className","data-id","data-name","String","currentItem","renderGap","renderSelectedRecord","render","document","getElementById"],"mappings":"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","file":"static/js/main.f3005bc6.chunk.js","sourcesContent":["import './App.css';\nimport React, { FC, useEffect, useState, ChangeEventHandler, MouseEventHandler } from 'react';\n\ntype Item = {\n  id: string;\n  name: string;\n  link: string;\n  stars: number;\n};\n\ntype Record =\n  | { state: 'ready'; fileName: string; }\n  | { state: 'loading'; fileName: string; }\n  | { state: 'success'; fileName: string; items: Item[]; }\n  | { state: 'error'; fileName: string; error: Error; }\n  ;\n\nconst suffixLength = '.###Z.csv'.length;\nconst App: FC = () => {\n  const [records, setRecords] = useState<Record[]>([]);\n  const [selectedRecordIndex, setSelectedRecordIndex] = useState<number | null>(null);\n  const [filter, setFilter] = useState('');\n\n  useEffect(() => {\n    void async function () {\n      const response = await fetch('data/index.log');\n      const text = await response.text();\n      const records: Record[] = text\n        .split('\\n')\n        // Remove newline\n        .slice(0, -1)\n        .map(fileName => ({\n          state: 'ready',\n          fileName,\n        }));\n\n      setRecords(records);\n      if (records.length > 0) {\n        setSelectedRecordIndex(records.length - 1);\n      }\n    }()\n  }, []);\n\n  useEffect(() => {\n    async function loadRecord(recordIndex: number) {\n      const record = records[recordIndex];\n\n      // Prevent loading an error which is already loading, loaded or failed\n      if (record.state !== 'ready') {\n        return;\n      }\n\n      // Mark the record as loading\n      setRecords(records.map((record, index) => index === recordIndex ? ({ state: 'loading', fileName: record.fileName }) : record));\n\n      let _record: Record;\n      try {\n        const response = await fetch('data/' + record.fileName);\n        const text = await response.text();\n        const items: Item[] = text\n          .split('\\n')\n          // Remove headers & newline\n          .slice(1, -1)\n          .map(item => {\n            const [id, name, stars, link] = item.split(';');\n            return { id, name, stars: Number(stars), link }\n          });\n        _record = {\n          state: 'success',\n          fileName: record.fileName,\n          items,\n        };\n      } catch (error) {\n        _record = {\n          state: 'error',\n          fileName: record.fileName,\n          error\n        }\n      }\n\n      // Mark the record as either loaded or errored\n      setRecords(records.map((record, index) => (index === recordIndex) ? _record : record));\n    }\n\n    if (selectedRecordIndex === null) {\n      return;\n    }\n\n    // Load the selected record\n    loadRecord(selectedRecordIndex);\n\n    // Load the prev record for comparison\n    if (selectedRecordIndex > 0) {\n      loadRecord(selectedRecordIndex - 1);\n    }\n\n    // Load the next record for comparison\n    if (selectedRecordIndex < records.length - 1) {\n      loadRecord(selectedRecordIndex + 1);\n    }\n  }, [selectedRecordIndex, records]);\n\n  const handleRecordSelectChange: ChangeEventHandler<HTMLSelectElement> = event => {\n    setSelectedRecordIndex(Number(event.currentTarget.value));\n  };\n\n  const [forceUpdateNonce, setForceUpdateNonce] = useState();\n  const handleToggleButtonClick: MouseEventHandler<HTMLButtonElement> = event => {\n    const { id, name } = event.currentTarget.dataset;\n    if (id === undefined || name === undefined) {\n      throw new Error('ID and name must be passed!');\n    }\n\n    if (localStorage.getItem(id)) {\n      localStorage.removeItem(id);\n    } else {\n      localStorage.setItem(id, name);\n    }\n\n    void forceUpdateNonce;\n    setForceUpdateNonce(Date.now);\n  };\n\n  const handleFilterInputChange: ChangeEventHandler<HTMLInputElement> = event => {\n    setFilter(event.currentTarget.value);\n  };\n\n  const handlePrevButtonClick: MouseEventHandler = event => {\n    if (selectedRecordIndex === null) {\n      return;\n    }\n\n    setSelectedRecordIndex(selectedRecordIndex > 0 ? selectedRecordIndex - 1 : records.length - 1);\n  };\n\n  const handleNextButtonClick: MouseEventHandler = event => {\n    if (selectedRecordIndex === null) {\n      return;\n    }\n\n    setSelectedRecordIndex(selectedRecordIndex < records.length - 1 ? selectedRecordIndex + 1 : 0);\n  };\n\n  function renderRelatedRecord(record: Record, item: Item, flipSign: boolean) {\n    if (record.state === 'ready' || record.state === 'loading') {\n      return 'Loading…';\n    }\n\n    if (record.state === 'error') {\n      return 'Error!';\n    }\n\n    const index = record.items.findIndex(i => i.id === item.id);\n    const comparedItem = record.items[index];\n    if (!comparedItem) {\n      return 'No match';\n    }\n\n    const change = item.stars - comparedItem.stars;\n    const difference = Math.abs(change);\n    const sign = Math.sign(change) > 0;\n    return (\n      <>\n        <code>{(sign || flipSign) ? '+' : '-'}</code>\n        {difference} ({comparedItem.stars})\n      </>\n    );\n  }\n\n  function renderSelectedRecord() {\n    if (selectedRecordIndex === null) {\n      return 'No record is selected';\n    }\n\n    const selectedRecord = records[selectedRecordIndex];\n    if (selectedRecord.state === 'ready') {\n      return 'Selected ' + selectedRecord.fileName;\n    }\n\n    if (selectedRecord.state === 'loading') {\n      return 'Loading ' + selectedRecord.fileName + '…';\n    }\n\n    if (selectedRecord.state === 'error') {\n      return selectedRecord.error.message;\n    }\n\n    const prevRecord = selectedRecordIndex > 0 ? records[selectedRecordIndex - 1] : null;\n    const nextRecord = selectedRecordIndex < records.length - 1 ? records[selectedRecordIndex + 1] : null;\n    return (\n      <table>\n        <thead>\n          <tr>\n            <th></th>\n            <th>#</th>\n            <th>ID</th>\n            <th>Name</th>\n            <th>Stars</th>\n            <th>Gap</th>\n            {prevRecord && <th>{prevRecord.fileName.slice(0, -suffixLength)}</th>}\n            {nextRecord && <th>{nextRecord.fileName.slice(0, -suffixLength)}</th>}\n          </tr>\n        </thead>\n        <tbody>\n          {selectedRecord.items.map((item, index) => item.name.toUpperCase().includes(filter.toUpperCase()) && (\n            <tr key={item.id} className={localStorage.getItem(item.id) ? '★' : '☆'}>\n              <td>\n                <button data-id={item.id} data-name={item.name} onClick={handleToggleButtonClick}>\n                  {localStorage.getItem(item.id) ? '★' : '☆'}\n                </button>\n              </td>\n              <td id={String(index + 1)}>\n                <a href={'#' + String(index + 1)}>{index + 1}</a>\n              </td>\n              <td>{item.id}</td>\n              <td id={item.name}>\n                <a href={'#' + item.name}>#</a>\n                {' '}\n                {item.link ? <a href={item.link}>{item.name}</a> : item.name}\n              </td>\n              <td>{item.stars}</td>\n              <td>{renderGap(selectedRecord.items, index)}</td>\n              {prevRecord && <td>{renderRelatedRecord(prevRecord, item, true)}</td>}\n              {nextRecord && <td>{renderRelatedRecord(nextRecord, item, false)}</td>}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n\n  function renderGap(items: Item[], index: number) {\n    if (index === 0) {\n      return null;\n    }\n\n    const currentItem = items[index];\n    let comparedItem: Item | undefined;\n    do {\n      index--;\n      comparedItem = items[index];\n    } while (index > 0 && (comparedItem === undefined || comparedItem.stars === currentItem.stars));\n\n    return comparedItem.stars - currentItem.stars;\n  }\n\n  return (\n    <div>\n      <button onClick={handlePrevButtonClick}>←</button>\n      <select onChange={handleRecordSelectChange} value={selectedRecordIndex || undefined}>\n        {records.map((record, index) => <option key={record.fileName} value={index}>{record.fileName.slice(0, -suffixLength)}</option>)}\n      </select>\n      <button onClick={handleNextButtonClick}>→</button>\n      <input placeholder=\"🔍\" value={filter} onChange={handleFilterInputChange} />\n      Copyright &copy; <a href=\"https://hubelbauer.net\">Tomas Hubelbauer</a> 2019.\n      <a href=\"https://github.com/TomasHubelbauer/net-ecosystem-review\">GitHub</a>\n      <hr />\n      {renderSelectedRecord()}\n    </div>\n  );\n}\n\nexport default App;\n","import './index.css';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport App from './App';\n\nrender(<App />, document.getElementById('root'));\n"],"sourceRoot":""}