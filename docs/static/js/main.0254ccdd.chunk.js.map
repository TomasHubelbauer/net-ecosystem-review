{"version":3,"sources":["App.tsx","index.tsx"],"names":["suffixLength","length","App","useState","records","setRecords","selectedRecordIndex","setSelectedRecordIndex","filter","setFilter","useEffect","a","fetch","response","text","split","slice","map","fileName","state","loadRecord","recordIndex","record","index","items","item","id","name","stars","Number","_record","error","setForceUpdateNonce","handleToggleButtonClick","event","currentTarget","dataset","undefined","Error","localStorage","getItem","removeItem","setItem","Date","now","renderRelatedRecord","flipSign","findIndex","i","comparedItem","change","difference","Math","abs","sign","onClick","onChange","value","key","placeholder","href","selectedRecord","message","prevRecord","nextRecord","toUpperCase","includes","className","data-id","data-name","String","currentItem","renderGap","renderSelectedRecord","render","document","getElementById"],"mappings":"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","file":"static/js/main.0254ccdd.chunk.js","sourcesContent":["import './App.css';\nimport React, { FC, useEffect, useState, ChangeEventHandler, MouseEventHandler } from 'react';\n\ntype Item = {\n  id: string;\n  name: string;\n  stars: number;\n};\n\ntype Record =\n  | { state: 'ready'; fileName: string; }\n  | { state: 'loading'; fileName: string; }\n  | { state: 'success'; fileName: string; items: Item[]; }\n  | { state: 'error'; fileName: string; error: Error; }\n  ;\n\nconst suffixLength = '.###Z.csv'.length;\nconst App: FC = () => {\n  const [records, setRecords] = useState<Record[]>([]);\n  const [selectedRecordIndex, setSelectedRecordIndex] = useState<number | null>(null);\n  const [filter, setFilter] = useState('');\n\n  useEffect(() => {\n    void async function () {\n      const response = await fetch('data/index.log');\n      const text = await response.text();\n      const records: Record[] = text\n        .split('\\n')\n        // Remove newline\n        .slice(0, -1)\n        .map(fileName => ({\n          state: 'ready',\n          fileName,\n        }));\n\n      setRecords(records);\n      if (records.length > 0) {\n        setSelectedRecordIndex(records.length - 1);\n      }\n    }()\n  }, []);\n\n  useEffect(() => {\n    async function loadRecord(recordIndex: number) {\n      const record = records[recordIndex];\n\n      // Prevent loading an error which is already loading, loaded or failed\n      if (record.state !== 'ready') {\n        return;\n      }\n\n      // Mark the record as loading\n      setRecords(records.map((record, index) => index === recordIndex ? ({ state: 'loading', fileName: record.fileName }) : record));\n\n      let _record: Record;\n      try {\n        const response = await fetch('data/' + record.fileName);\n        const text = await response.text();\n        const items: Item[] = text\n          .split('\\n')\n          // Remove headers & newline\n          .slice(1, -1)\n          .map(item => {\n            const [id, name, stars] = item.split(';');\n            return { id, name, stars: Number(stars) }\n          });\n        _record = {\n          state: 'success',\n          fileName: record.fileName,\n          items,\n        };\n      } catch (error) {\n        _record = {\n          state: 'error',\n          fileName: record.fileName,\n          error\n        }\n      }\n\n      // Mark the record as either loaded or errored\n      setRecords(records.map((record, index) => (index === recordIndex) ? _record : record));\n    }\n\n    if (selectedRecordIndex === null) {\n      return;\n    }\n\n    // Load the selected record\n    loadRecord(selectedRecordIndex);\n\n    // Load the prev record for comparison\n    if (selectedRecordIndex > 0) {\n      loadRecord(selectedRecordIndex - 1);\n    }\n\n    // Load the next record for comparison\n    if (selectedRecordIndex < records.length - 1) {\n      loadRecord(selectedRecordIndex + 1);\n    }\n  }, [selectedRecordIndex, records]);\n\n  const handleRecordSelectChange: ChangeEventHandler<HTMLSelectElement> = event => {\n    setSelectedRecordIndex(Number(event.currentTarget.value));\n  };\n\n  const [forceUpdateNonce, setForceUpdateNonce] = useState();\n  const handleToggleButtonClick: MouseEventHandler<HTMLButtonElement> = event => {\n    const { id, name } = event.currentTarget.dataset;\n    if (id === undefined || name === undefined) {\n      throw new Error('ID and name must be passed!');\n    }\n\n    if (localStorage.getItem(id)) {\n      localStorage.removeItem(id);\n    } else {\n      localStorage.setItem(id, name);\n    }\n\n    void forceUpdateNonce;\n    setForceUpdateNonce(Date.now);\n  };\n\n  const handleFilterInputChange: ChangeEventHandler<HTMLInputElement> = event => {\n    setFilter(event.currentTarget.value);\n  };\n\n  const handlePrevButtonClick: MouseEventHandler = event => {\n    if (selectedRecordIndex === null) {\n      return;\n    }\n\n    setSelectedRecordIndex(selectedRecordIndex > 0 ? selectedRecordIndex - 1 : records.length - 1);\n  };\n\n  const handleNextButtonClick: MouseEventHandler = event => {\n    if (selectedRecordIndex === null) {\n      return;\n    }\n\n    setSelectedRecordIndex(selectedRecordIndex < records.length - 1 ? selectedRecordIndex + 1 : 0);\n  };\n\n  function renderRelatedRecord(record: Record, item: Item, flipSign: boolean) {\n    if (record.state === 'ready' || record.state === 'loading') {\n      return 'Loading…';\n    }\n\n    if (record.state === 'error') {\n      return 'Error!';\n    }\n\n    const index = record.items.findIndex(i => i.id === item.id);\n    const comparedItem = record.items[index];\n    if (!comparedItem) {\n      return 'No match';\n    }\n\n    const change = item.stars - comparedItem.stars;\n    const difference = Math.abs(change);\n    const sign = Math.sign(change) > 0;\n    return (\n      <>\n        <code>{(sign || flipSign) ? '+' : '-'}</code>\n        {difference} ({comparedItem.stars})\n      </>\n    );\n  }\n\n  function renderSelectedRecord() {\n    if (selectedRecordIndex === null) {\n      return 'No record is selected';\n    }\n\n    const selectedRecord = records[selectedRecordIndex];\n    if (selectedRecord.state === 'ready') {\n      return 'Selected ' + selectedRecord.fileName;\n    }\n\n    if (selectedRecord.state === 'loading') {\n      return 'Loading ' + selectedRecord.fileName + '…';\n    }\n\n    if (selectedRecord.state === 'error') {\n      return selectedRecord.error.message;\n    }\n\n    const prevRecord = selectedRecordIndex > 0 ? records[selectedRecordIndex - 1] : null;\n    const nextRecord = selectedRecordIndex < records.length - 1 ? records[selectedRecordIndex + 1] : null;\n    return (\n      <table>\n        <thead>\n          <tr>\n            <th></th>\n            <th>#</th>\n            <th>ID</th>\n            <th>Name</th>\n            <th>Stars</th>\n            <th>Gap</th>\n            {prevRecord && <th>{prevRecord.fileName.slice(0, -suffixLength)}</th>}\n            {nextRecord && <th>{nextRecord.fileName.slice(0, -suffixLength)}</th>}\n          </tr>\n        </thead>\n        <tbody>\n          {selectedRecord.items.map((item, index) => item.name.toUpperCase().includes(filter.toUpperCase()) && (\n            <tr key={item.id} className={localStorage.getItem(item.id) ? '★' : '☆'}>\n              <td>\n                <button data-id={item.id} data-name={item.name} onClick={handleToggleButtonClick}>\n                  {localStorage.getItem(item.id) ? '★' : '☆'}\n                </button>\n              </td>\n              <td id={String(index + 1)}>\n                <a href={'#' + String(index + 1)}>{index + 1}</a>\n              </td>\n              <td>{item.id}</td>\n              <td id={item.name}>\n                <a href={'#' + item.name}>{item.name}</a>\n              </td>\n              <td>{item.stars}</td>\n              <td>{renderGap(selectedRecord.items, index)}</td>\n              {prevRecord && <td>{renderRelatedRecord(prevRecord, item, true)}</td>}\n              {nextRecord && <td>{renderRelatedRecord(nextRecord, item, false)}</td>}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n\n  function renderGap(items: Item[], index: number) {\n    if (index === 0) {\n      return null;\n    }\n\n    const currentItem = items[index];\n    let comparedItem: Item | undefined;\n    do {\n      index--;\n      comparedItem = items[index];\n    } while (index > 0 && (comparedItem === undefined || comparedItem.stars === currentItem.stars));\n\n    return comparedItem.stars - currentItem.stars;\n  }\n\n  return (\n    <div>\n      <button onClick={handlePrevButtonClick}>←</button>\n      <select onChange={handleRecordSelectChange} value={selectedRecordIndex || undefined}>\n        {records.map((record, index) => <option key={record.fileName} value={index}>{record.fileName.slice(0, -suffixLength)}</option>)}\n      </select>\n      <button onClick={handleNextButtonClick}>→</button>\n      <input placeholder=\"🔍\" value={filter} onChange={handleFilterInputChange} />\n      Copyright &copy; <a href=\"https://hubelbauer.net\">Tomas Hubelbauer</a> 2019.\n      <a href=\"https://github.com/TomasHubelbauer/net-ecosystem-review\">GitHub</a>\n      {renderSelectedRecord()}\n    </div>\n  );\n}\n\nexport default App;\n","import './index.css';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport App from './App';\n\nrender(<App />, document.getElementById('root'));\n"],"sourceRoot":""}